IMPORTANT
=========

This is the AUTHORITATIVE SOURCE of how to setup ckan for OpenUmea

Everything is REQUIRED to be automated and deployable by script.

This is also the DISASTER RECOVERY solution.

How full deployment works
=========================

Create elastic-ip and point your dns-name to it, CKAN_HOSTNAME

Create a bucket to store ckan-files in, CKAN_STORAGE_BUCKET

If you would like, create a bucket to store database backups, and maybe
set a life-cycle rule that removes to-old backups. DB_BACKUP_S3_BUCKET

Create a iam-role for the ckan-instance like:
{
  "Statement": [
    {
      "Action": [
        "s3:GetObject",
        "s3:ListBucket",
        "s3:PutObjectAcl",
        "s3:PutObject",
        "s3:ListBucketMultipartUploads"
      ],
      "Effect": "Allow",
      "Resource": [
        "arn:aws:s3:::CKAN_STORAGE_BUCKET",
        "arn:aws:s3:::CKAN_STORAGE_BUCKET/*",
        "arn:aws:s3:::DB_BACKUP_S3_BUCKET",
        "arn:aws:s3:::DB_BACKUP_S3_BUCKET/CKAN_HOSTNAME/*",
        "arn:aws:s3:::CREDENTIALS_BUCKET"
      ]
    },
    {
      "Action": "s3:GetObject",
      "Effect": "Allow",
      "Resource": "arn:aws:s3:::CREDENTIALS_BUCKET/*"
    },
    {
      "Action": [
        "ec2:AssociateAddress",
        "ec2:DescribeRegions"
      ],
      "Effect": "Allow",
      "Resource": ["*"]
    }
  ]
}

RECIPENT_EMAIL_ADDRESS is your email address, where the system will send
alerts to.

SENDER_EMAIL_ADDRESS is the address that the instance will send emails
from.

If you are doing a new deployment, fill in CKAN_SYSADMIN_USER /
CKAN_SYSADMIN_PW with what you would like to start with or..

If you are restoring a system from backup, point CKAN_BACKUP to the
backup you would like to restore from.

All variables are set in payload/config, read the comments.
combined-userdata.gz is generated by make

Use the chooser dialog in "Launch new instance" and choose a Ubuntu
12.04 amd64 ebs instance, or use http://cloud.ubuntu.com/ami/ to figure
out what ami-id is corresponding. Launch it in your iam-role, and feed it
your combined-userdata.gz as userdata.

Watch your system come up for the fist time, or see your disaster
recovered.
